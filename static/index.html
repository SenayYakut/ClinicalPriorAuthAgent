<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>ClearPath — Prior Authorization Agent</title>
<script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<style>
:root {
  --bg: #f8f9fb;
  --surface: #ffffff;
  --border: #e2e5ea;
  --ink: #111827;
  --ink2: #6b7280;
  --ink3: #9ca3af;
  --blue: #2563eb;
  --blue-light: #eff6ff;
  --green: #059669;
  --green-light: #ecfdf5;
  --amber: #d97706;
  --amber-light: #fffbeb;
  --red: #dc2626;
  --red-light: #fef2f2;
  --radius: 12px;
  --shadow: 0 1px 3px rgba(0,0,0,0.06), 0 2px 8px rgba(0,0,0,0.04);
}

* { box-sizing: border-box; margin: 0; padding: 0; }

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  background: var(--bg);
  color: var(--ink);
  line-height: 1.5;
}

header {
  background: var(--surface);
  border-bottom: 1px solid var(--border);
  padding: 0 32px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  height: 60px;
  position: sticky;
  top: 0;
  z-index: 100;
}

.logo { font-size: 20px; font-weight: 700; letter-spacing: -0.5px; }
.logo span { color: var(--blue); }

.badge {
  font-size: 11px;
  font-weight: 600;
  background: var(--blue-light);
  color: var(--blue);
  padding: 4px 12px;
  border-radius: 20px;
  letter-spacing: 0.3px;
}

.layout {
  max-width: 1400px;
  margin: 0 auto;
  padding: 24px 32px;
}

.tabs {
  display: flex;
  gap: 4px;
  margin-bottom: 24px;
  background: var(--surface);
  padding: 4px;
  border-radius: 10px;
  border: 1px solid var(--border);
  width: fit-content;
}

.tab {
  padding: 8px 20px;
  border-radius: 8px;
  border: none;
  background: transparent;
  color: var(--ink2);
  font-size: 14px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.15s;
}

.tab.active {
  background: var(--blue);
  color: white;
}

.tab:hover:not(.active) { background: var(--bg); }

.card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 24px;
  box-shadow: var(--shadow);
}

.card h2 {
  font-size: 16px;
  font-weight: 600;
  margin-bottom: 20px;
  color: var(--ink);
}

.grid { display: grid; gap: 16px; }
.grid-2 { grid-template-columns: 1fr 1fr; }
.grid-3 { grid-template-columns: 1fr 1fr 1fr; }

label {
  display: block;
  font-size: 13px;
  font-weight: 500;
  color: var(--ink2);
  margin-bottom: 6px;
}

input, select, textarea {
  width: 100%;
  padding: 10px 14px;
  border: 1px solid var(--border);
  border-radius: 8px;
  font-size: 14px;
  font-family: inherit;
  color: var(--ink);
  background: var(--surface);
  transition: border-color 0.15s;
}

input:focus, select:focus, textarea:focus {
  outline: none;
  border-color: var(--blue);
  box-shadow: 0 0 0 3px rgba(37,99,235,0.1);
}

textarea { resize: vertical; min-height: 120px; }

.btn {
  padding: 10px 24px;
  border-radius: 8px;
  border: none;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.15s;
  display: inline-flex;
  align-items: center;
  gap: 8px;
}

.btn-primary {
  background: var(--blue);
  color: white;
}
.btn-primary:hover { background: #1d4ed8; }
.btn-primary:disabled { opacity: 0.5; cursor: not-allowed; }

.btn-outline {
  background: transparent;
  color: var(--blue);
  border: 1px solid var(--blue);
}

.btn-green { background: var(--green); color: white; }
.btn-red { background: var(--red); color: white; }
.btn-sm { padding: 6px 14px; font-size: 13px; }

.status-badge {
  display: inline-block;
  padding: 4px 10px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 600;
  letter-spacing: 0.2px;
}

.status-processing { background: var(--blue-light); color: var(--blue); }
.status-auto_approved, .status-approved { background: var(--green-light); color: var(--green); }
.status-pending_review { background: var(--amber-light); color: var(--amber); }
.status-ready_to_submit { background: var(--blue-light); color: var(--blue); }
.status-denied { background: var(--red-light); color: var(--red); }
.status-error { background: var(--red-light); color: var(--red); }

.confidence-bar {
  height: 8px;
  background: #e5e7eb;
  border-radius: 4px;
  overflow: hidden;
  margin-top: 4px;
}

.confidence-fill {
  height: 100%;
  border-radius: 4px;
  transition: width 0.5s ease;
}

.stats-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 16px;
  margin-bottom: 24px;
}

.stat-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 20px;
  text-align: center;
}

.stat-value { font-size: 32px; font-weight: 700; color: var(--blue); }
.stat-label { font-size: 13px; color: var(--ink2); margin-top: 4px; }

.tool-step {
  display: flex;
  align-items: flex-start;
  gap: 12px;
  padding: 12px 0;
  border-bottom: 1px solid var(--border);
}

.tool-step:last-child { border-bottom: none; }

.tool-icon {
  width: 32px;
  height: 32px;
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 14px;
  flex-shrink: 0;
  background: var(--blue-light);
  color: var(--blue);
  font-weight: 700;
}

.tool-name { font-weight: 600; font-size: 14px; }
.tool-detail { font-size: 13px; color: var(--ink2); margin-top: 2px; }

.loading-spinner {
  display: inline-block;
  width: 20px;
  height: 20px;
  border: 3px solid rgba(255,255,255,0.3);
  border-top-color: white;
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

@keyframes spin { to { transform: rotate(360deg); } }

.agent-trace {
  background: #f9fafb;
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 16px;
  margin-top: 16px;
  max-height: 400px;
  overflow-y: auto;
}

.auth-letter {
  background: #fffef5;
  border: 1px solid #e5e0c8;
  border-radius: 8px;
  padding: 20px;
  font-family: 'Courier New', monospace;
  font-size: 13px;
  white-space: pre-wrap;
  line-height: 1.6;
  max-height: 500px;
  overflow-y: auto;
}

.sample-case-btn {
  padding: 12px 16px;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 8px;
  cursor: pointer;
  text-align: left;
  transition: all 0.15s;
  width: 100%;
}

.sample-case-btn:hover {
  border-color: var(--blue);
  background: var(--blue-light);
}

.sample-case-name { font-weight: 600; font-size: 14px; }
.sample-case-detail { font-size: 12px; color: var(--ink2); margin-top: 2px; }

.review-actions {
  display: flex;
  gap: 12px;
  margin-top: 16px;
}

.empty-state {
  text-align: center;
  padding: 60px 20px;
  color: var(--ink3);
}

.empty-state h3 { font-size: 18px; color: var(--ink2); margin-bottom: 8px; }

@media (max-width: 768px) {
  .grid-2, .grid-3, .stats-grid { grid-template-columns: 1fr; }
  .layout { padding: 16px; }
}
</style>
</head>
<body>

<div id="root"></div>

<script type="text/babel">
const { useState, useEffect } = React;

const API = '';

const TOOL_LABELS = {
  extract_diagnosis: { label: 'Extract Diagnosis', icon: '1' },
  lookup_payer_policy: { label: 'Lookup Policy', icon: '2' },
  draft_auth_request: { label: 'Draft Request', icon: '3' },
  predict_approval: { label: 'Predict Approval', icon: '4' },
  route_to_human: { label: 'Route to Human', icon: '5' },
};

function StatusBadge({ status }) {
  const labels = {
    processing: 'Processing',
    auto_approved: 'Auto-Approved',
    approved: 'Approved',
    pending_review: 'Needs Review',
    ready_to_submit: 'Ready to Submit',
    denied: 'Denied',
    error: 'Error',
  };
  return <span className={`status-badge status-${status}`}>{labels[status] || status}</span>;
}

function ConfidenceBar({ score }) {
  const color = score >= 85 ? 'var(--green)' : score >= 70 ? 'var(--amber)' : 'var(--red)';
  return (
    <div>
      <div style={{ display: 'flex', justifyContent: 'space-between', fontSize: 13 }}>
        <span style={{ color: 'var(--ink2)' }}>Approval Confidence</span>
        <span style={{ fontWeight: 700, color }}>{score}%</span>
      </div>
      <div className="confidence-bar">
        <div className="confidence-fill" style={{ width: `${score}%`, background: color }} />
      </div>
    </div>
  );
}

function SubmitCase({ onSubmit }) {
  const [samples, setSamples] = useState([]);
  const [form, setForm] = useState({
    patient_name: '', patient_age: '', patient_gender: 'Female',
    insurance_payer: 'united_healthcare', member_id: '',
    referring_physician: '', physician_npi: '',
    procedure_requested: '', cpt_codes: '', icd10_codes: '',
    clinical_notes: '',
  });
  const [loading, setLoading] = useState(false);

  useEffect(() => {
    fetch(`${API}/api/sample-cases`).then(r => r.json()).then(setSamples).catch(() => {});
  }, []);

  const loadSample = (sample) => {
    setForm({
      patient_name: sample.patient_name,
      patient_age: String(sample.patient_age),
      patient_gender: sample.patient_gender,
      insurance_payer: sample.insurance_payer,
      member_id: sample.member_id,
      referring_physician: sample.referring_physician,
      physician_npi: sample.physician_npi,
      procedure_requested: sample.procedure_requested,
      cpt_codes: sample.cpt_codes.join(', '),
      icd10_codes: sample.icd10_codes.join(', '),
      clinical_notes: sample.clinical_notes.trim(),
    });
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    setLoading(true);
    try {
      const payload = {
        ...form,
        patient_age: parseInt(form.patient_age),
        cpt_codes: form.cpt_codes.split(',').map(s => s.trim()).filter(Boolean),
        icd10_codes: form.icd10_codes.split(',').map(s => s.trim()).filter(Boolean),
      };
      const res = await fetch(`${API}/api/cases`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload),
      });
      const data = await res.json();
      if (!res.ok) throw new Error(data.detail || 'Failed');
      onSubmit(data);
    } catch (err) {
      alert('Error: ' + err.message);
    } finally {
      setLoading(false);
    }
  };

  return (
    <div>
      {samples.length > 0 && (
        <div className="card" style={{ marginBottom: 16 }}>
          <h2>Quick Start — Sample Cases</h2>
          <div className="grid grid-3">
            {samples.map((s, i) => (
              <button key={i} className="sample-case-btn" onClick={() => loadSample(s)}>
                <div className="sample-case-name">{s.patient_name}</div>
                <div className="sample-case-detail">{s.procedure_requested} | {s.insurance_payer.replace(/_/g, ' ')}</div>
              </button>
            ))}
          </div>
        </div>
      )}

      <form onSubmit={handleSubmit}>
        <div className="card" style={{ marginBottom: 16 }}>
          <h2>Patient Information</h2>
          <div className="grid grid-3">
            <div>
              <label>Patient Name</label>
              <input required value={form.patient_name} onChange={e => setForm({...form, patient_name: e.target.value})} />
            </div>
            <div>
              <label>Age</label>
              <input required type="number" value={form.patient_age} onChange={e => setForm({...form, patient_age: e.target.value})} />
            </div>
            <div>
              <label>Gender</label>
              <select value={form.patient_gender} onChange={e => setForm({...form, patient_gender: e.target.value})}>
                <option>Female</option><option>Male</option><option>Other</option>
              </select>
            </div>
          </div>
        </div>

        <div className="card" style={{ marginBottom: 16 }}>
          <h2>Insurance & Provider</h2>
          <div className="grid grid-2">
            <div>
              <label>Insurance Payer</label>
              <select value={form.insurance_payer} onChange={e => setForm({...form, insurance_payer: e.target.value})}>
                <option value="united_healthcare">United Healthcare</option>
                <option value="aetna">Aetna</option>
                <option value="blue_cross_blue_shield">Blue Cross Blue Shield</option>
              </select>
            </div>
            <div>
              <label>Member ID</label>
              <input required value={form.member_id} onChange={e => setForm({...form, member_id: e.target.value})} />
            </div>
            <div>
              <label>Referring Physician</label>
              <input required value={form.referring_physician} onChange={e => setForm({...form, referring_physician: e.target.value})} />
            </div>
            <div>
              <label>Physician NPI</label>
              <input required value={form.physician_npi} onChange={e => setForm({...form, physician_npi: e.target.value})} />
            </div>
          </div>
        </div>

        <div className="card" style={{ marginBottom: 16 }}>
          <h2>Procedure Details</h2>
          <div className="grid grid-2" style={{ marginBottom: 16 }}>
            <div>
              <label>Procedure Requested</label>
              <input required value={form.procedure_requested} onChange={e => setForm({...form, procedure_requested: e.target.value})} placeholder="e.g., Total Knee Replacement" />
            </div>
            <div>
              <label>CPT Codes (comma-separated)</label>
              <input required value={form.cpt_codes} onChange={e => setForm({...form, cpt_codes: e.target.value})} placeholder="e.g., 27447" />
            </div>
          </div>
          <div style={{ marginBottom: 16 }}>
            <label>ICD-10 Codes (comma-separated)</label>
            <input required value={form.icd10_codes} onChange={e => setForm({...form, icd10_codes: e.target.value})} placeholder="e.g., M17.11" />
          </div>
          <div>
            <label>Clinical Notes</label>
            <textarea required rows={10} value={form.clinical_notes} onChange={e => setForm({...form, clinical_notes: e.target.value})} placeholder="Paste clinical notes here..." />
          </div>
        </div>

        <button type="submit" className="btn btn-primary" disabled={loading} style={{ width: '100%', justifyContent: 'center', padding: '14px' }}>
          {loading ? <><span className="loading-spinner" /> Processing with AI Agent...</> : 'Submit for Prior Authorization'}
        </button>
      </form>
    </div>
  );
}

function CaseResult({ caseData, onBack }) {
  const result = caseData.agent_result || {};
  const toolResults = result.tool_results || [];

  const prediction = toolResults.find(t => t.tool === 'predict_approval');
  const routing = toolResults.find(t => t.tool === 'route_to_human');

  return (
    <div>
      <button className="btn btn-outline btn-sm" onClick={onBack} style={{ marginBottom: 16 }}>Back to Cases</button>

      <div className="stats-grid" style={{ gridTemplateColumns: 'repeat(3, 1fr)' }}>
        <div className="stat-card">
          <div className="stat-value" style={{ fontSize: 24 }}>{caseData.case_id}</div>
          <div className="stat-label">Case ID</div>
        </div>
        <div className="stat-card">
          <StatusBadge status={caseData.status} />
          <div className="stat-label" style={{ marginTop: 8 }}>Status</div>
        </div>
        <div className="stat-card">
          <div className="stat-value">{caseData.confidence_score || '—'}%</div>
          <div className="stat-label">Approval Confidence</div>
        </div>
      </div>

      <div className="grid grid-2" style={{ marginBottom: 16 }}>
        <div className="card">
          <h2>Patient Summary</h2>
          <p><strong>{caseData.patient_name}</strong>, {caseData.patient_age}yo {caseData.patient_gender}</p>
          <p style={{ color: 'var(--ink2)', fontSize: 13, marginTop: 4 }}>
            {caseData.insurance_payer?.replace(/_/g, ' ')} | {caseData.member_id}
          </p>
          <p style={{ marginTop: 8 }}><strong>Procedure:</strong> {caseData.procedure_requested}</p>
          <p style={{ fontSize: 13, color: 'var(--ink2)' }}>
            CPT: {caseData.cpt_codes?.join(', ')} | ICD-10: {caseData.icd10_codes?.join(', ')}
          </p>
        </div>

        <div className="card">
          <h2>Approval Prediction</h2>
          {prediction ? (
            <>
              <ConfidenceBar score={prediction.output.confidence_score} />
              <div style={{ marginTop: 12 }}>
                <div style={{ fontSize: 13 }}>
                  <strong style={{ color: 'var(--green)' }}>Strengths:</strong>
                  <ul style={{ marginLeft: 16, marginTop: 4 }}>
                    {prediction.output.strengths?.map((s, i) => <li key={i}>{s}</li>)}
                  </ul>
                </div>
                {prediction.output.weaknesses?.length > 0 && (
                  <div style={{ fontSize: 13, marginTop: 8 }}>
                    <strong style={{ color: 'var(--red)' }}>Risks:</strong>
                    <ul style={{ marginLeft: 16, marginTop: 4 }}>
                      {prediction.output.weaknesses?.map((w, i) => <li key={i}>{w}</li>)}
                    </ul>
                  </div>
                )}
                {prediction.output.missing_documentation?.length > 0 && (
                  <div style={{ fontSize: 13, marginTop: 8 }}>
                    <strong style={{ color: 'var(--amber)' }}>Missing Docs:</strong>
                    <ul style={{ marginLeft: 16, marginTop: 4 }}>
                      {prediction.output.missing_documentation?.map((d, i) => <li key={i}>{d}</li>)}
                    </ul>
                  </div>
                )}
              </div>
            </>
          ) : <p style={{ color: 'var(--ink3)' }}>No prediction available</p>}
        </div>
      </div>

      {caseData.auth_letter && (
        <div className="card" style={{ marginBottom: 16 }}>
          <h2>Authorization Request Letter</h2>
          <div className="auth-letter">{caseData.auth_letter}</div>
        </div>
      )}

      <div className="card" style={{ marginBottom: 16 }}>
        <h2>Agent Trace — Tool Execution</h2>
        <div className="agent-trace">
          {toolResults.map((tr, i) => {
            const meta = TOOL_LABELS[tr.tool] || { label: tr.tool, icon: '?' };
            return (
              <div key={i} className="tool-step">
                <div className="tool-icon">{meta.icon}</div>
                <div style={{ flex: 1 }}>
                  <div className="tool-name">{meta.label}</div>
                  <div className="tool-detail">
                    {tr.tool === 'extract_diagnosis' && `Primary: ${tr.input.primary_diagnosis}`}
                    {tr.tool === 'lookup_payer_policy' && `Payer: ${tr.input.payer_id} | Procedure: ${tr.input.procedure_type}`}
                    {tr.tool === 'draft_auth_request' && `Letter generated for ${tr.input.patient_name}`}
                    {tr.tool === 'predict_approval' && `Score: ${tr.input.confidence_score}% | Risk: ${tr.input.risk_level}`}
                    {tr.tool === 'route_to_human' && `Reason: ${tr.input.reason}`}
                  </div>
                </div>
              </div>
            );
          })}
        </div>
      </div>

      {routing && (
        <div className="card" style={{ borderColor: 'var(--amber)', background: 'var(--amber-light)' }}>
          <h2>Human Review Required</h2>
          <p><strong>Reason:</strong> {routing.output.reason}</p>
          <p><strong>Urgency:</strong> {routing.output.urgency}</p>
          <p><strong>Suggested Reviewer:</strong> {routing.output.suggested_reviewer}</p>
          {routing.output.key_questions?.length > 0 && (
            <div style={{ marginTop: 8 }}>
              <strong>Questions for Reviewer:</strong>
              <ul style={{ marginLeft: 16, marginTop: 4 }}>
                {routing.output.key_questions.map((q, i) => <li key={i}>{q}</li>)}
              </ul>
            </div>
          )}
          <div className="review-actions">
            <button className="btn btn-green btn-sm" onClick={() => submitReview(caseData.case_id, 'approved')}>Approve</button>
            <button className="btn btn-red btn-sm" onClick={() => submitReview(caseData.case_id, 'denied')}>Deny</button>
          </div>
        </div>
      )}

      {result.agent_summary && (
        <div className="card" style={{ marginTop: 16 }}>
          <h2>Agent Summary</h2>
          <div style={{ fontSize: 14, lineHeight: 1.7, whiteSpace: 'pre-wrap' }}>{result.agent_summary}</div>
        </div>
      )}
    </div>
  );
}

async function submitReview(caseId, decision) {
  const notes = prompt(`Enter reviewer notes for ${decision}:`) || '';
  await fetch(`${API}/api/review`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ case_id: caseId, decision, reviewer_notes: notes }),
  });
  window.location.reload();
}

function CaseList({ onSelect }) {
  const [cases, setCases] = useState([]);

  useEffect(() => {
    fetch(`${API}/api/cases`).then(r => r.json()).then(setCases).catch(() => {});
  }, []);

  if (cases.length === 0) {
    return (
      <div className="empty-state">
        <h3>No cases yet</h3>
        <p>Submit a case to get started</p>
      </div>
    );
  }

  return (
    <div>
      {cases.map((c, i) => (
        <div key={i} className="card" style={{ marginBottom: 12, cursor: 'pointer' }} onClick={() => onSelect(c)}>
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
            <div>
              <strong>{c.patient_name}</strong>
              <span style={{ color: 'var(--ink3)', marginLeft: 12, fontSize: 13 }}>{c.case_id}</span>
            </div>
            <div style={{ display: 'flex', alignItems: 'center', gap: 16 }}>
              {c.confidence_score && <span style={{ fontSize: 14, fontWeight: 600 }}>{c.confidence_score}%</span>}
              <StatusBadge status={c.status} />
            </div>
          </div>
          <div style={{ fontSize: 13, color: 'var(--ink2)', marginTop: 4 }}>
            {c.procedure_requested} | {c.insurance_payer?.replace(/_/g, ' ')} | {c.referring_physician}
          </div>
        </div>
      ))}
    </div>
  );
}

function ReviewQueue() {
  const [queue, setQueue] = useState([]);

  useEffect(() => {
    fetch(`${API}/api/review-queue`).then(r => r.json()).then(setQueue).catch(() => {});
  }, []);

  if (queue.length === 0) {
    return (
      <div className="empty-state">
        <h3>No pending reviews</h3>
        <p>Cases with low confidence scores will appear here for human review</p>
      </div>
    );
  }

  return (
    <div>
      {queue.map((c, i) => {
        const routing = c.agent_result?.tool_results?.find(t => t.tool === 'route_to_human');
        return (
          <div key={i} className="card" style={{ marginBottom: 12, borderLeft: '4px solid var(--amber)' }}>
            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
              <div>
                <strong>{c.patient_name}</strong>
                <span style={{ color: 'var(--ink3)', marginLeft: 12, fontSize: 13 }}>{c.case_id}</span>
              </div>
              <span style={{ fontSize: 14, fontWeight: 700, color: 'var(--amber)' }}>{c.confidence_score}%</span>
            </div>
            <p style={{ fontSize: 13, color: 'var(--ink2)', marginTop: 4 }}>{c.procedure_requested}</p>
            {routing && <p style={{ fontSize: 13, marginTop: 8 }}><strong>Reason:</strong> {routing.output.reason}</p>}
            <div className="review-actions">
              <button className="btn btn-green btn-sm" onClick={() => submitReview(c.case_id, 'approved')}>Approve</button>
              <button className="btn btn-red btn-sm" onClick={() => submitReview(c.case_id, 'denied')}>Deny</button>
            </div>
          </div>
        );
      })}
    </div>
  );
}

function Dashboard() {
  const [stats, setStats] = useState(null);

  useEffect(() => {
    fetch(`${API}/api/stats`).then(r => r.json()).then(setStats).catch(() => {});
  }, []);

  if (!stats) return <div className="empty-state"><p>Loading...</p></div>;

  return (
    <div>
      <div className="stats-grid">
        <div className="stat-card">
          <div className="stat-value">{stats.total_cases}</div>
          <div className="stat-label">Total Cases</div>
        </div>
        <div className="stat-card">
          <div className="stat-value" style={{ color: 'var(--green)' }}>{stats.statuses?.auto_approved || stats.statuses?.approved || 0}</div>
          <div className="stat-label">Approved</div>
        </div>
        <div className="stat-card">
          <div className="stat-value" style={{ color: 'var(--amber)' }}>{stats.pending_reviews}</div>
          <div className="stat-label">Pending Review</div>
        </div>
        <div className="stat-card">
          <div className="stat-value">{stats.average_confidence}%</div>
          <div className="stat-label">Avg. Confidence</div>
        </div>
      </div>
    </div>
  );
}

function App() {
  const [tab, setTab] = useState('submit');
  const [selectedCase, setSelectedCase] = useState(null);

  const handleSubmit = (caseData) => {
    setSelectedCase(caseData);
    setTab('result');
  };

  return (
    <div>
      <header>
        <div className="logo">Clear<span>Path</span></div>
        <div className="badge">PRIOR AUTH AGENT — AZURE AI</div>
      </header>

      <div className="layout">
        <div className="tabs">
          <button className={`tab ${tab === 'submit' ? 'active' : ''}`} onClick={() => { setTab('submit'); setSelectedCase(null); }}>New Case</button>
          <button className={`tab ${tab === 'cases' ? 'active' : ''}`} onClick={() => { setTab('cases'); setSelectedCase(null); }}>All Cases</button>
          <button className={`tab ${tab === 'review' ? 'active' : ''}`} onClick={() => setTab('review')}>Review Queue</button>
          <button className={`tab ${tab === 'dashboard' ? 'active' : ''}`} onClick={() => setTab('dashboard')}>Dashboard</button>
        </div>

        {tab === 'submit' && <SubmitCase onSubmit={handleSubmit} />}
        {tab === 'cases' && !selectedCase && <CaseList onSelect={(c) => { setSelectedCase(c); setTab('result'); }} />}
        {tab === 'result' && selectedCase && <CaseResult caseData={selectedCase} onBack={() => { setTab('cases'); setSelectedCase(null); }} />}
        {tab === 'review' && <ReviewQueue />}
        {tab === 'dashboard' && <Dashboard />}
      </div>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(<App />);
</script>
</body>
</html>
